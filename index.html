<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI äº¤äº’åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.12/marked.min.js"></script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 flex justify-center items-center min-h-screen">
    <div class="w-full max-w-lg bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100">AI äº¤äº’åŠ©æ‰‹</h2>
            <button onclick="toggleDarkMode()" class="px-2 py-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-md">ğŸŒ™</button>
        </div>
        <div id="chatbox" class="h-80 overflow-y-auto border p-4 bg-gray-50 dark:bg-gray-700 rounded-lg mb-4 space-y-2"></div>
        <div class="flex space-x-2">
            <input id="userInput" type="text" class="flex-1 p-2 border rounded-lg dark:bg-gray-600 dark:text-white" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..." onkeypress="handleKeyPress(event)">
            <button onclick="sendMessage()" class="px-4 py-2 bg-blue-500 text-white rounded-lg">å‘é€</button>
        </div>
    </div>

    <script>
        const API_KEY = "sk-ocyVjypZVQYI4JzmpcbfKvzB27u8ERxJBYnkcp8psvCAqCVM";
        const BASE_URL = "https://cn.gptapi.asia/v1/chat/completions";

        async function sendMessage() {
            const inputField = document.getElementById("userInput");
            const chatbox = document.getElementById("chatbox");
            const userMessage = inputField.value.trim();
            if (!userMessage) return;

            appendMessage("user", userMessage);
            inputField.value = "";

            try {
                const res = await fetch(BASE_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: `Bearer ${API_KEY}`,
                    },
                    body: JSON.stringify({
                        model: "gpt-4",
                        messages: [{ role: "user", content: userMessage }],
                    }),
                });

                const data = await res.json();
                const aiResponse = data.choices?.[0]?.message?.content || "æ— å“åº”";
                appendMessage("ai", aiResponse);
            } catch (error) {
                appendMessage("ai", "è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ API è®¾ç½®");
            }
        }

        function appendMessage(role, text) {
            const chatbox = document.getElementById("chatbox");
            const messageDiv = document.createElement("div");
            messageDiv.classList.add("p-2", "rounded-lg", "max-w-xs", "animate-fadeIn");
            
            if (role === "user") {
                messageDiv.classList.add("bg-blue-500", "text-white", "self-end", "ml-auto");
            } else {
                messageDiv.classList.add("bg-gray-300", "text-black", "self-start", "mr-auto");
                messageDiv.innerHTML = marked.parse(text); // Markdown æ¸²æŸ“
            }
            
            messageDiv.innerHTML = text;
            chatbox.appendChild(messageDiv);
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        function handleKeyPress(event) {
            if (event.key === "Enter") {
                sendMessage();
            }
        }

        function toggleDarkMode() {
            document.body.classList.toggle("dark");
        }
    </script>
</body>
</html>
